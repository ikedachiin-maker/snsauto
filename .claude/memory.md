# Project Memory（長期記憶）

このファイルには「長期に効く不変のルール」のみを記載します。
タスク固有の情報は task_contract.md や running_summary.md に記載します。

---

## アーキテクチャルール

### Proxy-Only
- すべての外部MCP通信は `taisun-proxy` 経由で行う
- Claude Desktop からは単一エンドポイントのみ公開
- 内部MCPサーバーは直接公開しない

### 遅延ロード（Lazy Loading）
- 重いモジュールは必要になるまでロードしない
- オプショナル依存はtry-catchでガード
- 起動時間を最小化する

### 出力外部化
- 大量の出力は会話に垂れ流さない
- ファイルに書き出して参照を渡す
- artifacts/ ディレクトリを活用

---

## セキュリティルール

### コマンド実行
- execSync の文字列補間は禁止
- spawnSync + 配列引数を使用
- ユーザー入力は必ずサニタイズ

### ネットワーク
- デフォルトは deny（最小権限）
- ワイルドカード許可は禁止
- localhost バインドが基本

### 秘密情報
- トークン・パスワードをログに書かない
- 環境変数経由で注入
- .gitignore で除外

---

## 品質ルール

### エラーハンドリング
- 空の catch ブロックは禁止
- 最低でも debug レベルでログ
- エラー状態を正確に報告（success: true の誤用禁止）

### テスト
- 変更にはテストを付ける
- カバレッジ 80% 以上を目標
- Critical/High 脆弱性はゼロ

### ドキュメント
- Issue/RUNLOG は日本語
- コード識別子・パスは英語可
- 秘密情報は絶対に含めない

---

## Issue運用ルール

### ログ形式
```markdown
## 概要
...

## 作成リソース
- Issue: #xxx
- PR: #xxx
- Branch: feature/xxx

## 実装内容
...

## テスト結果
...

## 次のステップ
...
```

### ラベル
- `approval-required`: 人間承認が必要
- `bug`: バグ修正
- `feature`: 新機能
- `docs`: ドキュメント

---

## 変更履歴
- 2026-01-07: 初版作成（Master Prompt Framework導入）
